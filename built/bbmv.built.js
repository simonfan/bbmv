//     bbmv
//     (c) simonfan
//     bbmv is licensed under the MIT terms.

define("bbmv/aux/general",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.camelCase=function(e){return e.replace(/[-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""})},t.buildPrefixRegExp=function(e){return e=n.isArray(e)?e:[e],new RegExp("^(?:"+e.join("|")+")([A-Z$_].*$)?")},t.lowercaseFirst=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},t.uppercaseFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}),define("bbmv/aux/parse-dest-str",["require","exports","module","lodash"],function(e,t,n){function i(e){var t=e.split(o),n=t[0],i=t[1],r=i?i.split(a):[];return{method:n,args:r}}function r(e){e=e.replace(d,"");var t=e.match(u),n=i(t[3]);return t[2]&&(n.selector=t[2]),t[1]&&(n.format=i(t[1])),n}var s=e("lodash"),o=/\s*:\s*/g,a=/\s*,\s*/g;t.methodString=i;var u=/\s*(?:(.+?)\s*\|)?\s*(?:(.+?)\s*->)?\s*(.+)\s*/,d=/\n/g,p=/\s*;\s*/g;n.exports=function(e){return s(e.split(p)).map(r).compact().value()}}),define("bbmv/aux/index",["require","exports","module","lodash","bbmv/aux/general","bbmv/aux/parse-dest-str"],function(e,t){var n=e("lodash");n.assign(t,e("bbmv/aux/general")),t.parseDestStr=e("bbmv/aux/parse-dest-str"),t.getDefaultDOMEvent=function(e,t){return n.find(t,function(t,n){return e.is(n)})}}),define("bbmv/pipe/aux",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.format=function i(e,t,r,i,s){var o=e[i.method];o=n.isFunction(o)?o:o[r];var a=n.clone(i.args);if(a.push(s),!o)throw new Error("[bbmv|destGet/destSet] "+i.method+" could not be found.");return o.apply(e,a)},t.executeMethod=function(e,t,n,i){return t[n]?t[n].apply(t,i):(i.unshift(t),e[n].apply(e,i))}}),define("bbmv/pipe/dest-get",["require","exports","module","jquery-value","lodash","bbmv/aux/index","bbmv/pipe/aux"],function(e,t,n){var i=(e("jquery-value"),e("lodash")),r=(e("bbmv/aux/index"),e("bbmv/pipe/aux"));n.exports=function(e,t){var n=this.bbmvInstance,s=this.parseDestStr(t)[0];e=s.selector?e.find(s.selector):e;var o=s.method,a=i.clone(s.args),u=r.executeMethod(n,e,o,a);return u=s.format?r.format(n,e,"in",s.format,u):u}}),define("bbmv/pipe/dest-set",["require","exports","module","jquery-value","lodash","bbmv/aux/index","bbmv/pipe/aux"],function(e,t,n){function i(e,t,n,i){if(!t.is(":focus")){i=n.format?s.format(e,t,"out",n.format,i):i,t=n.selector?t.find(n.selector):t;var o=r.clone(n.args);o.push(i);var a=n.method;return s.executeMethod(e,t,a,o)}}var r=(e("jquery-value"),e("lodash")),s=(e("bbmv/aux/index"),e("bbmv/pipe/aux"));n.exports=function(e,t,n){var s=this.parseDestStr(t);r.each(s,function(t){return i(this.bbmvInstance,e,t,n)},this)}}),define("bbmv/pipe/index",["require","exports","module","pipe","lodash","bbmv/aux/index","bbmv/pipe/dest-get","bbmv/pipe/dest-set"],function(e,t,n){var i=e("pipe"),r=e("lodash"),s=e("bbmv/aux/index"),o=(i.prototype.to,i.prototype.from,i.prototype.mapSingle,i.prototype.initialize),a=n.exports=i.extend({initialize:function(e,t,n,i){this._parsedDestStrs={},o.apply(this,r.toArray(arguments)),i=i||{},r.each(["namespace","bbmvInstance"],function(e){this[e]=i[e]||this[e]},this)},parseDestStr:function(e){var t=this._parsedDestStrs[e];return t||(t=this._parsedDestStrs[e]=s.parseDestStr(e)),t},srcGet:function(e,t){return e.get(t)},srcSet:function(e,t,n){return e.set(t,n)}});a.assignProto({destGet:e("bbmv/pipe/dest-get"),destSet:e("bbmv/pipe/dest-set")})}),define("bbmv/directives/data-bind",["require","exports","module","lodash","bbmv/aux/index"],function(e,t){var n=e("lodash"),i=e("bbmv/aux/index");t["in"]=function(e,t){var n=this.pipe(e);n.map(t,{direction:"from"});var r=e.data(this.bindingEventAttribute)||i.getDefaultDOMEvent(e,this.defaultDOMEvents);r&&e.on(r,function(){n.drain({force:!0})})},t.out=function(e,t){var n=this.pipe(e);n.map(t,{direction:"to"})},t.dual=t[""]=function(e,t){var n=this.pipe(e);n.map(t,{direction:"both"});var r=e.data(this.bindingEventAttribute)||i.getDefaultDOMEvent(e,this.defaultDOMEvents);r&&e.on(r,function(){n.drain({force:!0})})},t.set=function(e,t){var r=e.data(this.bindingEventAttribute)||i.getDefaultDOMEvent(e,this.defaultDOMEvents);r&&e.on(r,n.partial(n.bind(this.model.set,this.model),t))}}),define("bbmv/directives/event",["require","exports","module","lodash"],function(e,t){function n(e){var t=e.split(o),n=t[0],i=t[1],r=i?i.split(a):[];return{name:n,args:r}}function i(e,t,i,r){var s=n(r);t.on(i,function(){t[s.name]?t[s.name].apply(t,s.args):(s.args.unshift(t),e[s.name].apply(e,s.args))})}var r=e("lodash"),s=/\s*=>\s*/,o=/\s*:\s*/,a=/\s*,\s*/;t.on=function(e,t){if(r.isObject(t))r.each(t,function(t,n){i(this,e,n,t)},this);else{var n=t.split(s),o=n[0],a=n[1];i(this,e,o,a)}}}),define("bbmv/directives/index",["require","exports","module","lodash","jquery","bbmv/directives/data-bind","bbmv/directives/event"],function(e,t){{var n=e("lodash");e("jquery")}t.defaultDOMEvents={":text":"keyup",'input[type="checkbox"],input[type="radio"]':"change",":button":"click"};var i={};t.directives=i,n.assign(i,e("bbmv/directives/data-bind")),n.assign(i,e("bbmv/directives/event"))}),define("bbmv/methods/if",["require","exports","module","lodash"],function(e,t){function n(e,t){var n=e.match(s),i=n[1]||"=";return e=n[2],r[i](e,t)}var i=e("lodash"),r={">":function(e,t){return parseFloat(t)>parseFloat(e)},">=":function(e,t){return parseFloat(t)>=parseFloat(e)},"<":function(e,t){return parseFloat(t)<parseFloat(e)},"<=":function(e,t){return parseFloat(t)<=parseFloat(e)},"s>":function(e,t){return t>e},"s>=":function(e,t){return t>=e},"s<":function(e,t){return e>t},"s<=":function(e,t){return e>=t},"=":function(e,t){return t==e},"==":function(e,t){return t===e},"!":function(e,t){return t!=e},"!=":function(e,t){return t!==e},"#":function(e,t){return!i.isUndefined(t)},"!#":function(e,t){return i.isUndefined(t)}},s=/^(>=|>|<=|<|s>=|s>|s<=|s<|==|=|#|!#|!=|!)?\s*(.*)\s*/,o=/\s*=>\s*/,a=/\s*\/\s*/;t["if"]=function(e,t,r){var s=t.split(a);return i.find(s,function(t){var i=t.split(o);return 1===i.length?(this[i[0]].call(this,e,r),!0):n(i[0],r)?(this[i[1]].call(this,e,r),!0):!1},this)}}),define("bbmv/methods/model-methods",["require","exports","module"],function(e,t){t.save=function(){return this.model.save()},t.set=function(e,t,n){return this.model.set(t,n)},t.fetch=function(){return this.model.fetch()},t.clear=function(){return this.model.clear()},t.destroy=function(){return this.model.destroy()},t.validate=function(){return this.model.validate()}}),define("bbmv",["require","exports","module","jquery-selector-data-prefix","lodash","jquery","bbdv","lowercase-backbone","bbmv/pipe/index","bbmv/aux/index","bbmv/directives/index","bbmv/methods/if","bbmv/methods/model-methods"],function(e,t,n){function i(){return["bbdv",this.namespace,this.cid,"id"].join("_")}e("jquery-selector-data-prefix");var r=e("lodash"),s=(e("jquery"),e("bbdv")),o=(e("lowercase-backbone"),e("bbmv/pipe/index")),a=e("bbmv/aux/index"),u=n.exports=s.extend({initialize:function(e){if(e=e||{},r.each(["namespace","binding","event","bindingEventAttribute"],function(t){this[t]=e[t]||this[t]},this),this.namespace=e.namespace||this.namespace,this.pipeIdAttr=i.call(this),this.pipes={},s.prototype.initialize.call(this,e),!this.model)throw new Error("No model set for model view.");if(!this.$el)throw new Error("No el set on model view.");this.model.on(this.event,function(){this.pump()},this),this.pump()},event:"change",bindingEventAttribute:"binding-event",namespace:"bind",selector:function(e){return this.binding?'[data-binding="'+this.binding+'"]':":data-prefix("+a.camelCase(e)+")"},pump:function(){return r.each(this.pipes,function(e){e.pump()}),this},drain:function(e,t,n){return this.pipe(e).drain(t,n),this},pipe:function(e,t,n){var i,s=e.data(this.pipeIdAttr);return s&&this.pipes[s]?i=this.pipes[s]:(s=r.uniqueId(this.pipeIdAttr),n=n||{},n.bbmvInstance=this,i=this.pipes[s]=o(this.model,e,t,n),e.data(this.pipeIdAttr,s)),i}});u.assignProto(e("bbmv/directives/index")).assignProto(e("bbmv/methods/if")).assignProto(e("bbmv/methods/model-methods"))});