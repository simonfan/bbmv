//     bbmv
//     (c) simonfan
//     bbmv is licensed under the MIT terms.

define("bbmv/aux/general",["require","exports","module","lodash"],function(e,t){var i=e("lodash");t.buildPrefixRegExp=function(e){return e=i.isArray(e)?e:[e],new RegExp("^(?:"+e.join("|")+")([A-Z$_].*$)?")},t.lowercaseFirst=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},t.uppercaseFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}),define("bbmv/aux/parse-dest-str",["require","exports","module","lodash"],function(e,t,i){function n(e){var t=e.split(o),i=t[0],n=t[1],r=n?n.split(a):[];return{method:i,args:r}}function r(e){e=e.replace(d,"");var t=e.match(u),i=n(t[3]);return t[2]&&(i.selector=t[2]),t[1]&&(i.format=n(t[1])),i}var s=e("lodash"),o=/\s*:\s*/g,a=/\s*,\s*/g;t.methodString=n;var u=/\s*(?:(.+?)\s*\|)?\s*(?:(.+?)\s*->)?\s*(.+)\s*/,d=/\n/g,p=/\s*;\s*/g;i.exports=function(e){return s(e.split(p)).map(r).compact().value()}}),define("bbmv/aux/index",["require","exports","module","lodash","bbmv/aux/general","bbmv/aux/parse-dest-str"],function(e,t){var i=e("lodash");i.assign(t,e("bbmv/aux/general")),t.parseDestStr=e("bbmv/aux/parse-dest-str"),t.getDefaultDOMEvent=function(e,t){return i.find(t,function(t,i){return e.is(i)})}}),define("bbmv/pipe/aux",["require","exports","module","lodash"],function(e,t){var i=e("lodash");t.format=function n(e,t,r,n,s){var o=e[n.method];o=i.isFunction(o)?o:o[r];var a=i.clone(n.args);if(a.push(s),!o)throw new Error("[bbmv|destGet/destSet] "+n.method+" could not be found.");return o.apply(e,a)},t.executeMethod=function(e,t,i,n){return t[i]?t[i].apply(t,n):(n.unshift(t),e[i].apply(e,n))}}),define("bbmv/pipe/dest-get",["require","exports","module","jquery-value","lodash","bbmv/aux/index","bbmv/pipe/aux"],function(e,t,i){var n=(e("jquery-value"),e("lodash")),r=(e("bbmv/aux/index"),e("bbmv/pipe/aux"));i.exports=function(e,t){var i=this.bbmvInstance,s=this.parseDestStr(t)[0];e=s.selector?e.find(s.selector):e;var o=s.method,a=n.clone(s.args),u=r.executeMethod(i,e,o,a);return u=s.format?r.format(i,e,"in",s.format,u):u}}),define("bbmv/pipe/dest-set",["require","exports","module","jquery-value","lodash","bbmv/aux/index","bbmv/pipe/aux"],function(e,t,i){function n(e,t,i,n){if(!t.is(":focus")){n=i.format?s.format(e,t,"out",i.format,n):n,t=i.selector?t.find(i.selector):t;var o=r.clone(i.args);o.push(n);var a=i.method;return s.executeMethod(e,t,a,o)}}var r=(e("jquery-value"),e("lodash")),s=(e("bbmv/aux/index"),e("bbmv/pipe/aux"));i.exports=function(e,t,i){var s=this.parseDestStr(t);r.each(s,function(t){return n(this.bbmvInstance,e,t,i)},this)}}),define("bbmv/pipe/index",["require","exports","module","pipe","lodash","bbmv/aux/index","bbmv/pipe/dest-get","bbmv/pipe/dest-set"],function(e,t,i){var n=e("pipe"),r=e("lodash"),s=e("bbmv/aux/index"),o=(n.prototype.to,n.prototype.from,n.prototype.mapSingle,n.prototype.initialize),a=i.exports=n.extend({initialize:function(e,t,i,n){this._parsedDestStrs={},o.apply(this,r.toArray(arguments)),n=n||{},r.each(["namespace","bbmvInstance"],function(e){this[e]=n[e]||this[e]},this)},parseDestStr:function(e){var t=this._parsedDestStrs[e];return t||(t=this._parsedDestStrs[e]=s.parseDestStr(e)),t},srcGet:function(e,t){return e.get(t)},srcSet:function(e,t,i){return e.set(t,i)}});a.assignProto({destGet:e("bbmv/pipe/dest-get"),destSet:e("bbmv/pipe/dest-set")})}),define("bbmv/aux",["require","exports","module","jquery-selector-data-prefix"],function(e,t){e("jquery-selector-data-prefix"),t.findBoundElements=function(e,t){var i=e.find(":data-prefix("+t+")");return e.add(i)}}),define("bbmv/directives/data-bind",["require","exports","module","lodash","bbmv/aux/index"],function(e,t){var i=e("lodash"),n=e("bbmv/aux/index");t["in"]=function(e,t){var i=this.pipe(e);i.map(t,{direction:"from"});var r=e.data(this.bindingEventAttribute)||n.getDefaultDOMEvent(e,this.defaultDOMEvents);r&&e.on(r,function(){i.drain({force:!0})})},t.out=function(e,t){var i=this.pipe(e);i.map(t,{direction:"to"})},t.dual=t[""]=function(e,t){var i=this.pipe(e);i.map(t,{direction:"both"});var r=e.data(this.bindingEventAttribute)||n.getDefaultDOMEvent(e,this.defaultDOMEvents);r&&e.on(r,function(){i.drain({force:!0})})},t.set=function(e,t){var r=e.data(this.bindingEventAttribute)||n.getDefaultDOMEvent(e,this.defaultDOMEvents);r&&e.on(r,i.partial(i.bind(this.model.set,this.model),t))}}),define("bbmv/directives/event",["require","exports","module","lodash"],function(e,t){function i(e){var t=e.split(o),i=t[0],n=t[1],r=n?n.split(a):[];return{name:i,args:r}}function n(e,t,n,r){var s=i(r);t.on(n,function(){t[s.name]?t[s.name].apply(t,s.args):(s.args.unshift(t),e[s.name].apply(e,s.args))})}var r=e("lodash"),s=/\s*=>\s*/,o=/\s*:\s*/,a=/\s*,\s*/;t.on=function(e,t){if(r.isObject(t))r.each(t,function(t,i){n(this,e,i,t)},this);else{var i=t.split(s),o=i[0],a=i[1];n(this,e,o,a)}}}),define("bbmv/directives/index",["require","exports","module","lodash","jquery","bbmv/directives/data-bind","bbmv/directives/event"],function(e,t){{var i=e("lodash");e("jquery")}t.defaultDOMEvents={":text":"keyup",'input[type="checkbox"],input[type="radio"]':"change",":button":"click"};var n={};t.directives=n,i.assign(n,e("bbmv/directives/data-bind")),i.assign(n,e("bbmv/directives/event"))}),define("bbmv/methods/if",["require","exports","module","lodash"],function(e,t){function i(e,t){var i=e.match(s),n=i[1]||"=";return e=i[2],r[n](e,t)}var n=e("lodash"),r={">":function(e,t){return parseFloat(t)>parseFloat(e)},">=":function(e,t){return parseFloat(t)>=parseFloat(e)},"<":function(e,t){return parseFloat(t)<parseFloat(e)},"<=":function(e,t){return parseFloat(t)<=parseFloat(e)},"s>":function(e,t){return t>e},"s>=":function(e,t){return t>=e},"s<":function(e,t){return e>t},"s<=":function(e,t){return e>=t},"=":function(e,t){return t==e},"==":function(e,t){return t===e},"!":function(e,t){return t!=e},"!=":function(e,t){return t!==e},"#":function(e,t){return!n.isUndefined(t)},"!#":function(e,t){return n.isUndefined(t)}},s=/^(>=|>|<=|<|s>=|s>|s<=|s<|==|=|#|!#|!=|!)?\s*(.*)\s*/,o=/\s*=>\s*/,a=/\s*\/\s*/;t["if"]=function(e,t,r){var s=t.split(a);return n.find(s,function(t){var n=t.split(o);return 1===n.length?(this[n[0]].call(this,e,r),!0):i(n[0],r)?(this[n[1]].call(this,e,r),!0):!1},this)}}),define("bbmv/methods/model-methods",["require","exports","module"],function(e,t){t.save=function(){return this.model.save()},t.fetch=function(){return this.model.fetch()},t.clear=function(){return this.model.clear()},t.destroy=function(){return this.model.destroy()},t.validate=function(){return this.model.validate()}}),define("bbmv",["require","exports","module","jquery-selector-data-prefix","lodash","jquery","bbdv","lowercase-backbone","bbmv/pipe/index","bbmv/aux","bbmv/directives/index","bbmv/methods/if","bbmv/methods/model-methods"],function(e,t,i){function n(){return["bbdv",this.namespace,this.cid,"id"].join("_")}e("jquery-selector-data-prefix");var r=e("lodash"),s=(e("jquery"),e("bbdv")),o=(e("lowercase-backbone"),e("bbmv/pipe/index")),a=(e("bbmv/aux"),i.exports=s.extend({initialize:function(e){if(e=e||{},r.each(["namespace","binding","event","bindingEventAttribute"],function(t){this[t]=e[t]||this[t]},this),this.namespace=e.namespace||this.namespace,this.pipeIdAttr=n.call(this),this.pipes={},s.prototype.initialize.call(this,e),!this.model)throw new Error("No model set for model view.");if(!this.$el)throw new Error("No el set on model view.");this.model.on(this.event,function(){this.pump()},this),this.pump()},event:"change",bindingEventAttribute:"binding-event",namespace:"bind",selector:function(e){return this.binding?'[data-binding="'+this.binding+'"]':":data-prefix("+e+")"},pump:function(){return r.each(this.pipes,function(e){e.pump()}),this},drain:function(e,t,i){return this.pipe(e).drain(t,i),this},pipe:function(e,t,i){var n,s=e.data(this.pipeIdAttr);return s&&this.pipes[s]?n=this.pipes[s]:(s=r.uniqueId(this.pipeIdAttr),i=i||{},i.bbmvInstance=this,n=this.pipes[s]=o(this.model,e,t,i),e.data(this.pipeIdAttr,s)),n}}));a.assignProto(e("bbmv/directives/index")).assignProto(e("bbmv/methods/if")).assignProto(e("bbmv/methods/model-methods"))});