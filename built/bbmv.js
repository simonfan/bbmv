//     Bbdv
//     (c) simonfan
//     Bbdv is licensed under the MIT terms.

//     bbmv
//     (c) simonfan
//     bbmv is licensed under the MIT terms.

define("bbdv/aux",["require","exports","module"],function(e,t){t.camelCase=function(e){return e.replace(/[-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""})},t.buildPrefixRegExp=function(e){return new RegExp("^"+e+"([A-Z$_].*$|$)")},t.lowercaseFirst=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},t.uppercaseFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}),define("bbdv/extract-directive-arguments",["require","exports","module","lodash","bbdv/aux"],function(e,t,i){function r(e,t){return s.camelCase(e+"-"+t)}var n=e("lodash"),s=e("bbdv/aux");i.exports=function(e,t,i){e=e||"",t.sort(function(e,t){return t.length-e.length});var a={};return n.each(i,function(i,o){n.any(t,function(t){var u=r(e,t);if(n.has(a,t)&&!n.isObject(a[t]))return!1;if(u===o)return a[t]=i,!0;var p=s.buildPrefixRegExp(u),d=o.match(p);if(d){var c=a[t];return c||(c=a[t]={}),c[s.lowercaseFirst(d[1])]=i,!0}return!1},this)},this),a}}),define("bbdv/execute-directives",["require","exports","module","lodash","bbdv/extract-directive-arguments","bbdv/aux"],function(e,t,i){var r=e("lodash"),n=e("bbdv/extract-directive-arguments");e("bbdv/aux"),i.exports=function(e,t,i){var s=n(t,r.keys(i),e.data());r.each(s,function(t,r){if(""===r){var n=i[""]||i["default"];n.call(this,e,t)}else i[r].call(this,e,t)},this)}}),define("bbdv",["require","exports","module","jquery-selector-data-prefix","lowercase-backbone","jquery","lodash","bbdv/execute-directives","bbdv/aux"],function(e,t,i){function r(e,t){var i;return i=e.is(t)?e.add(e.find(t)):e.find(t)}e("jquery-selector-data-prefix");var n=e("lowercase-backbone"),s=e("jquery");_=e("lodash");var a=e("bbdv/execute-directives"),o=e("bbdv/aux"),u=n.view.prototype.initialize,p=i.exports=n.view.extend({initialize:function(e){u.call(this,e),_.each(["namespace","directives"],function(t){this[t]=e[t]||this[t]},this);var t=this.selector(this.namespace),i=r(this.$el,t);this.directives=_.reduce(this.directives,function(e,t,i){return e[o.camelCase(i)]=_.isFunction(t)?t:this[t],e},{},this);var n=this.namespace,p=this.directives;_.each(i,function(e){a.call(this,s(e),n,p)},this)},directives:{},namespace:"dir",selector:function(e){return":data-prefix("+e+")"}});p.assignStatic("directive",function(){_.isObject(arguments[0])?_.assign(this.prototype.directives,arguments[0]):this.prototype.directives[arguments[0]]=arguments[1]}),p.assignStatic("extendDirectives",function(e){var t=_.create(this.prototype.directives);_.assign(t,e);var i=this.extend({directives:t});return i})}),define("bbmv/pipe/aux/general",["require","exports","module","lodash"],function(e,t){var i=e("lodash");t.buildPrefixRegExp=function(e){return e=i.isArray(e)?e:[e],new RegExp("^(?:"+e.join("|")+")([A-Z$_].*$)?")},t.lowercaseFirst=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},t.uppercaseFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}),define("bbmv/pipe/aux/parse-dest-str",["require","exports","module","lodash"],function(e,t,i){function r(e){var t=e.split(a),i=t.shift();return{method:i,args:t}}function n(e){var t=e.match(o),i=r(t[3]);return t[2]&&(i.selector=t[2]),t[1]&&(i.format=r(t[1])),i}var s=e("lodash"),a=/\s*:\s*/g;t.methodString=r;var o=/\s*(?:(.+?)\s*\|)?\s*(?:(.+?)\s*->)?\s*(.+)\s*/;i.exports=function(e){return s.map(e.split(/\s*,\s*/g),n)}}),define("bbmv/pipe/aux/index",["require","exports","module","lodash","bbmv/pipe/aux/general","bbmv/pipe/aux/parse-dest-str"],function(e,t){var i=e("lodash");i.assign(t,e("bbmv/pipe/aux/general")),t.parseDestStr=e("bbmv/pipe/aux/parse-dest-str")}),define("bbmv/pipe/dest-get",["require","exports","module","jquery-value","lodash","bbmv/pipe/aux/index"],function(e,t,i){{var r=(e("jquery-value"),e("lodash"));e("bbmv/pipe/aux/index")}i.exports=function(e,t){var i=this.context,n=this.parseDestStr(t)[0],s=n.method,a=e[s]||i[s];if(!a)throw new Error("[bbmv pipe|destGet] "+s+" could not be found.");e=n.selector?e.find(n.selector):e;var o=a.apply(e,n.args),u=n.format;if(u){var p=i[u.method];if(p=r.isFunction(p)?p:p["in"],!p)throw new Error("[bbmv|destGet] "+u.method+" could not be found.");var d=r.clone(u.args);d.push(o),o=p.apply(i,d)}return o}}),define("bbmv/pipe/dest-set",["require","exports","module","jquery-value","lodash","bbmv/pipe/aux/index"],function(e,t,i){function r(e,t,i,r){var s=e.context,a=i.format;if(a){var o=s[a.method];if(o=n.isFunction(o)?o:o.out,!o)throw new Error("[bbmv pipe|destGet] "+a.method+" could not be found.");var u=n.clone(a.args);u.push(r),r=o.apply(s,u)}var u=n.clone(i.args);u.push(r);var p=i.method,d=t[p]||s[p];if(!d)throw new Error("[bbmv|destSet] "+p+" could not be found.");return i.selector&&(t=t.find(i.selector)),d.apply(t,u)}{var n=(e("jquery-value"),e("lodash"));e("bbmv/pipe/aux/index")}i.exports=function(e,t,i){var s=this.parseDestStr(t);n.each(s,function(t){return r(this,e,t,i)},this)}}),define("bbmv/pipe/index",["require","exports","module","pipe","lodash","bbmv/pipe/aux/index","bbmv/pipe/dest-get","bbmv/pipe/dest-set"],function(e,t,i){var r=e("pipe");_=e("lodash");var n=e("bbmv/pipe/aux/index"),s=(r.prototype.to,r.prototype.from,r.prototype.mapSingle,r.prototype.initialize),a=i.exports=r.extend({initialize:function(e,t,i,r){this._parsedDestStrs={},s.apply(this,_.toArray(arguments)),r=r||{},_.each(["namespace","context"],function(e){this[e]=r[e]||this[e]},this)},parseDestStr:function(e){var t=this._parsedDestStrs[e];return t||(t=this._parsedDestStrs[e]=n.parseDestStr(e)),t},srcGet:function(e,t){return e.get(t)},srcSet:function(e,t,i){return e.set(t,i)}});a.assignProto({destGet:e("bbmv/pipe/dest-get"),destSet:e("bbmv/pipe/dest-set")})}),define("bbmv/aux",["require","exports","module","jquery-selector-data-prefix"],function(e,t){e("jquery-selector-data-prefix"),t.findBoundElements=function(e,t){var i=e.find(":data-prefix("+t+")");return e.add(i)}}),define("bbmv/directives",["require","exports","module","lodash","jquery"],function(e,t){{var i=e("lodash");e("jquery")}t.directives={"in":"bindIn",out:"bindOut",dual:"bindDual",event:"bindEvent","":"bindDual"},t.defaultDOMEvents={INPUT:"change",BUTTON:"click"},t.bindEvent=function(e,t){var r=this.pipe(e);i.isObject(t)?i.each(t,function(t,i){e.on(i,function(){r.drain(t.split(/\s*,\s*/),{force:!0})})}):(t=i.isString(t)&&""!==t?t:this.defaultDOMEvents[e.prop("tagName")],e.on(t,i.partial(i.bind(r.drain,r),{force:!0})))},t.bindIn=function(e,t){var i=this.pipe(e),r=this.defaultDOMEvents[e.prop("tagName")];console.log(this),r&&e.on(r,function(){i.drain({force:!0})}),i.map(t,"from")},t.bindOut=function(e,t){var i=this.pipe(e);i.map(t,"to")},t.bindDual=function(e,t){var i=this.defaultDOMEvents[e.prop("tagName")];i&&e.on(i,function(){r.drain({force:!0})});var r=this.pipe(e);r.map(t,"both")}}),define("bbmv",["require","exports","module","lodash","jquery","bbdv","lowercase-backbone","bbmv/pipe/index","bbmv/aux","bbmv/directives"],function(e,t,i){function r(){return["bbdv",this.namespace,this.cid,"id"].join("_")}var n=e("lodash"),s=(e("jquery"),e("bbdv")),a=(e("lowercase-backbone"),e("bbmv/pipe/index")),o=(e("bbmv/aux"),i.exports=s.extend({initialize:function(e){if(this.namespace=e.namespace||this.namespace,this.pipeIdAttr=r.call(this),this.pipes={},s.prototype.initialize.call(this,e),!this.model)throw new Error("No model set for model view.");if(!this.$el)throw new Error("No el set on model view.");this.model.on(this.event,function(){console.log("change"),this.pump()},this),this.pump()},event:"change",namespace:"bind",pump:function(){return n.each(this.pipes,function(e){e.pump()}),this},drain:function(e){return this.pipe(e).drain(),this},pipe:function(e,t,i){var r,s=e.data(this.pipeIdAttr);return s&&this.pipes[s]?r=this.pipes[s]:(s=n.uniqueId(this.pipeIdAttr),i=i||{},i.context=this,r=this.pipes[s]=a(this.model,e,t,i),e.data(this.pipeIdAttr,s)),r}}));o.assignProto(e("bbmv/directives"))});