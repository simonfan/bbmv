//     bbmv
//     (c) simonfan
//     bbmv is licensed under the MIT terms.

define("bbmv/aux/general",["require","exports","module","lodash"],function(e,t){var i=e("lodash");t.buildPrefixRegExp=function(e){return e=i.isArray(e)?e:[e],new RegExp("^(?:"+e.join("|")+")([A-Z$_].*$)?")},t.lowercaseFirst=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},t.uppercaseFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}),define("bbmv/aux/parse-dest-str",["require","exports","module","lodash"],function(e,t,i){function n(e){var t=e.split(a),i=t[0],n=t[1],r=n?n.split(o):[];return{method:i,args:r}}function r(e){var t=e.match(u),i=n(t[3]);return t[2]&&(i.selector=t[2]),t[1]&&(i.format=n(t[1])),i}var s=e("lodash"),a=/\s*:\s*/g,o=/\s*,\s*/g;t.methodString=n;var u=/\s*(?:(.+?)\s*\|)?\s*(?:(.+?)\s*->)?\s*(.+)\s*/,p=/\s*;\s*/g;i.exports=function(e){return s(e.split(p)).map(r).compact().value()}}),define("bbmv/aux/index",["require","exports","module","lodash","bbmv/aux/general","bbmv/aux/parse-dest-str","jquery-selector-data-prefix"],function(e,t){var i=e("lodash");i.assign(t,e("bbmv/aux/general")),t.parseDestStr=e("bbmv/aux/parse-dest-str"),e("jquery-selector-data-prefix"),t.findBoundElements=function(e,t){var i=e.find(":data-prefix("+t+")");return e.add(i)}}),define("bbmv/pipe/dest-get",["require","exports","module","jquery-value","lodash","bbmv/aux/index"],function(e,t,i){{var n=(e("jquery-value"),e("lodash"));e("bbmv/aux/index")}i.exports=function(e,t){var i=this.context,r=this.parseDestStr(t)[0];e=r.selector?e.find(r.selector):e;var s,a=r.method;if(n.isFunction(e[a]))s=e[a].apply(e,r.args);else{var o=n.clone(r.args);o.unshift(e),s=i[a].apply(i,o)}var u=r.format;if(u){var p=i[u.method];if(p=n.isFunction(p)?p:p["in"],!p)throw new Error("[bbmv|destGet] "+u.method+" could not be found.");var d=n.clone(u.args);d.push(s),s=p.apply(i,d)}return s}}),define("bbmv/pipe/dest-set",["require","exports","module","jquery-value","lodash","bbmv/aux/index"],function(e,t,i){function n(e,t,i,n){if(!t.is(":focus")){var s=e.context,a=i.format;if(a){var o=s[a.method];if(o=r.isFunction(o)?o:o.out,!o)throw new Error("[bbmv pipe|destGet] "+a.method+" could not be found.");var u=r.clone(a.args);u.push(n),n=o.apply(s,u)}i.selector&&(t=t.find(i.selector));var p=r.clone(i.args);p.push(n);var d=i.method;return t[d]?t[d].apply(t,p):(p.unshift(t),s[d].apply(s,p))}}{var r=(e("jquery-value"),e("lodash"));e("bbmv/aux/index")}i.exports=function(e,t,i){var s=this.parseDestStr(t);r.each(s,function(t){return n(this,e,t,i)},this)}}),define("bbmv/pipe/index",["require","exports","module","pipe","lodash","bbmv/aux/index","bbmv/pipe/dest-get","bbmv/pipe/dest-set"],function(e,t,i){var n=e("pipe"),r=e("lodash"),s=e("bbmv/aux/index"),a=(n.prototype.to,n.prototype.from,n.prototype.mapSingle,n.prototype.initialize),o=i.exports=n.extend({initialize:function(e,t,i,n){this._parsedDestStrs={},a.apply(this,r.toArray(arguments)),n=n||{},r.each(["namespace","context"],function(e){this[e]=n[e]||this[e]},this)},parseDestStr:function(e){var t=this._parsedDestStrs[e];return t||(t=this._parsedDestStrs[e]=s.parseDestStr(e)),t},srcGet:function(e,t){return e.get(t)},srcSet:function(e,t,i){return e.set(t,i)}});o.assignProto({destGet:e("bbmv/pipe/dest-get"),destSet:e("bbmv/pipe/dest-set")})}),define("bbmv/aux",["require","exports","module","jquery-selector-data-prefix"],function(e,t){e("jquery-selector-data-prefix"),t.findBoundElements=function(e,t){var i=e.find(":data-prefix("+t+")");return e.add(i)}}),define("bbmv/directives/data-bind",["require","exports","module","lodash"],function(e,t){var i=e("lodash");t["in"]=function(e,t){var i=this.pipe(e);i.map(t,"from");var n=e.data(this.namespace+"-on")||this.defaultDOMEvents[e.prop("tagName")];n&&e.on(n,function(){i.drain({force:!0})})},t.out=function(e,t){var i=this.pipe(e);i.map(t,"to")},t.dual=t[""]={exclude:["on"],fn:function(e,t){var i=e.data(this.namespace+"-on")||this.defaultDOMEvents[e.prop("tagName")];i&&e.on(i,function(){n.drain({force:!0})});var n=this.pipe(e);n.map(t,"both")}},t.set=function(e,t){var n=e.data(this.namespace+"-on")||this.defaultDOMEvents[e.prop("tagName")];e.on(n,i.partial(i.bind(this.model.set,this.model),t))}}),define("bbmv/directives/event",["require","exports","module","lodash"],function(e,t){function i(e){var t=e.split(a),i=t[0],n=t[1],r=n?n.split(o):[];return{name:i,args:r}}function n(e,t,n,r){var s=i(r);t.on(n,function(){t[s.name]?t[s.name].apply(t,s.args):(s.args.unshift(t),e[s.name].apply(e,s.args))})}var r=e("lodash"),s=/\s*=>\s*/,a=/\s*:\s*/,o=/\s*,\s*/;t.event=function(e,t){if(r.isObject(t))r.each(t,function(t,i){n(this,e,i,t)},this);else{var i=t.split(s),a=i[0],o=i[1];n(this,e,a,o)}}}),define("bbmv/directives/index",["require","exports","module","lodash","jquery","bbmv/directives/data-bind","bbmv/directives/event"],function(e,t){{var i=e("lodash");e("jquery")}t.defaultDOMEvents={INPUT:"change",BUTTON:"click"};var n={};t.directives=n,i.assign(n,e("bbmv/directives/data-bind")),i.assign(n,e("bbmv/directives/event"))}),define("bbmv/pipe-methods/if",["require","exports","module","lodash"],function(e,t){function i(e,t){var i=e.match(s),n=i[1]||"=";return e=i[2],r[n](e,t)}var n=e("lodash"),r={">":function(e,t){return parseFloat(t)>parseFloat(e)},">=":function(e,t){return parseFloat(t)>=parseFloat(e)},"<":function(e,t){return parseFloat(t)<parseFloat(e)},"<=":function(e,t){return parseFloat(t)<=parseFloat(e)},"s>":function(e,t){return t>e},"s>=":function(e,t){return t>=e},"s<":function(e,t){return e>t},"s<=":function(e,t){return e>=t},"=":function(e,t){return t==e},"==":function(e,t){return t===e},"!":function(e,t){return t!=e},"!=":function(e,t){return t!==e},"#":function(e,t){return!n.isUndefined(t)},"!#":function(e,t){return n.isUndefined(t)}},s=/^(>=|>|<=|<|s>=|s>|s<=|s<|==|=|#|!#|!=|!)?\s*(.*)\s*/,a=/\s*=>\s*/,o=/\s*\/\s*/;t["if"]=function(e,t,r){var s=t.split(o);return n.find(s,function(t){var n=t.split(a);return 1===n.length?(this[n[0]].call(this,e,r),!0):i(n[0],r)?(this[n[1]].call(this,e,r),!0):!1},this)}}),define("bbmv/pipe-methods/model-methods",["require","exports","module"],function(e,t){t.save=function(){return this.model.save()}}),define("bbmv",["require","exports","module","lodash","jquery","bbdv","lowercase-backbone","bbmv/pipe/index","bbmv/aux","bbmv/directives/index","bbmv/pipe-methods/if","bbmv/pipe-methods/model-methods"],function(e,t,i){function n(){return["bbdv",this.namespace,this.cid,"id"].join("_")}var r=e("lodash"),s=(e("jquery"),e("bbdv")),a=(e("lowercase-backbone"),e("bbmv/pipe/index")),o=(e("bbmv/aux"),i.exports=s.extend({initialize:function(e){if(this.namespace=e.namespace||this.namespace,this.pipeIdAttr=n.call(this),this.pipes={},s.prototype.initialize.call(this,e),!this.model)throw new Error("No model set for model view.");if(!this.$el)throw new Error("No el set on model view.");this.model.on(this.event,function(){this.pump()},this),this.pump()},event:"change",namespace:"bind",pump:function(){return r.each(this.pipes,function(e){e.pump()}),this},drain:function(e,t,i){return this.pipe(e).drain(t,i),this},pipe:function(e,t,i){var n,s=e.data(this.pipeIdAttr);return s&&this.pipes[s]?n=this.pipes[s]:(s=r.uniqueId(this.pipeIdAttr),i=i||{},i.context=this,n=this.pipes[s]=a(this.model,e,t,i),e.data(this.pipeIdAttr,s)),n}}));o.assignProto(e("bbmv/directives/index")).assignProto(e("bbmv/pipe-methods/if")).assignProto(e("bbmv/pipe-methods/model-methods"))});