//     bbmv
//     (c) simonfan
//     bbmv is licensed under the MIT terms.

define("bbmv/pipe/aux/general",["require","exports","module","lodash"],function(e,t){var i=e("lodash");t.buildPrefixRegExp=function(e){return e=i.isArray(e)?e:[e],new RegExp("^(?:"+e.join("|")+")([A-Z$_].*$)?")},t.lowercaseFirst=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},t.uppercaseFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}),define("bbmv/pipe/aux/parse-dest-str",["require","exports","module","lodash"],function(e,t,i){function n(e){var t=e.split(a),i=t[0],n=t[1],r=n?n.split(o):[];return{method:i,args:r}}function r(e){var t=e.match(p),i=n(t[3]);return t[2]&&(i.selector=t[2]),t[1]&&(i.format=n(t[1])),i}var s=e("lodash"),a=/\s*:\s*/g,o=/\s*,\s*/g;t.methodString=n;var p=/\s*(?:(.+?)\s*\|)?\s*(?:(.+?)\s*->)?\s*(.+)\s*/,u=/\s*;\s*/g;i.exports=function(e){return s(e.split(u)).map(r).compact().value()}}),define("bbmv/pipe/aux/index",["require","exports","module","lodash","bbmv/pipe/aux/general","bbmv/pipe/aux/parse-dest-str"],function(e,t){var i=e("lodash");i.assign(t,e("bbmv/pipe/aux/general")),t.parseDestStr=e("bbmv/pipe/aux/parse-dest-str")}),define("bbmv/pipe/dest-get",["require","exports","module","jquery-value","lodash","bbmv/pipe/aux/index"],function(e,t,i){{var n=(e("jquery-value"),e("lodash"));e("bbmv/pipe/aux/index")}i.exports=function(e,t){var i=this.context,r=this.parseDestStr(t)[0];e=r.selector?e.find(r.selector):e;var s,a=r.method;if(n.isFunction(e[a]))s=e[a].apply(e,r.args);else{var o=n.clone(r.args);o.unshift(e),s=i[a].apply(i,o)}var p=r.format;if(p){var u=i[p.method];if(u=n.isFunction(u)?u:u["in"],!u)throw new Error("[bbmv|destGet] "+p.method+" could not be found.");var o=n.clone(p.args);o.push(s),s=u.apply(i,o)}return s}}),define("bbmv/pipe/dest-set",["require","exports","module","jquery-value","lodash","bbmv/pipe/aux/index"],function(e,t,i){function n(e,t,i,n){if(!t.is(":focus")){var s=e.context,a=i.format;if(a){var o=s[a.method];if(o=r.isFunction(o)?o:o.out,!o)throw new Error("[bbmv pipe|destGet] "+a.method+" could not be found.");var p=r.clone(a.args);p.push(n),n=o.apply(s,p)}i.selector&&(t=t.find(i.selector));var u=r.clone(i.args);u.push(n);var d=i.method;return t[d]?t[d].apply(t,u):(u.unshift(t),s[d].apply(s,u))}}{var r=(e("jquery-value"),e("lodash"));e("bbmv/pipe/aux/index")}i.exports=function(e,t,i){var s=this.parseDestStr(t);r.each(s,function(t){return n(this,e,t,i)},this)}}),define("bbmv/pipe/index",["require","exports","module","pipe","lodash","bbmv/pipe/aux/index","bbmv/pipe/dest-get","bbmv/pipe/dest-set"],function(e,t,i){var n=e("pipe");_=e("lodash");var r=e("bbmv/pipe/aux/index"),s=(n.prototype.to,n.prototype.from,n.prototype.mapSingle,n.prototype.initialize),a=i.exports=n.extend({initialize:function(e,t,i,n){this._parsedDestStrs={},s.apply(this,_.toArray(arguments)),n=n||{},_.each(["namespace","context"],function(e){this[e]=n[e]||this[e]},this)},parseDestStr:function(e){var t=this._parsedDestStrs[e];return t||(t=this._parsedDestStrs[e]=r.parseDestStr(e)),t},srcGet:function(e,t){return e.get(t)},srcSet:function(e,t,i){return e.set(t,i)}});a.assignProto({destGet:e("bbmv/pipe/dest-get"),destSet:e("bbmv/pipe/dest-set")})}),define("bbmv/aux",["require","exports","module","jquery-selector-data-prefix"],function(e,t){e("jquery-selector-data-prefix"),t.findBoundElements=function(e,t){var i=e.find(":data-prefix("+t+")");return e.add(i)}}),define("bbmv/directives",["require","exports","module","lodash","jquery"],function(e,t){{var i=e("lodash");e("jquery")}t.directives={"in":"bindIn",out:"bindOut",dual:"bindDual",set:"bindSet","":"bindDual"},t.defaultDOMEvents={INPUT:"change",BUTTON:"click"},t.bindIn=function(e,t){var i=this.pipe(e);i.map(t,"from");var n=e.data(this.namespace+"-on")||this.defaultDOMEvents[e.prop("tagName")];n&&e.on(n,function(){i.drain({force:!0})})},t.bindOut=function(e,t){var i=this.pipe(e);i.map(t,"to")},t.bindDual={exclude:["on"],fn:function(e,t){var i=e.data(this.namespace+"-on")||this.defaultDOMEvents[e.prop("tagName")];i&&e.on(i,function(){n.drain({force:!0})});var n=this.pipe(e);n.map(t,"both")}},t.bindSet=function(e,t){var n=e.data(this.namespace+"-on")||this.defaultDOMEvents[e.prop("tagName")];e.on(n,i.partial(i.bind(this.model.set,this.model),t))}}),define("bbmv/pipe-methods/if",["require","exports","module"],function(e,t){function i(e,t){var i=e.match(r),s=i[1]||"=";return e=i[2],n[s](e,t)}var n={">":function(e,t){return parseFloat(t)>parseFloat(e)},">=":function(e,t){return parseFloat(t)>=parseFloat(e)},"<":function(e,t){return parseFloat(t)<parseFloat(e)},"<=":function(e,t){return parseFloat(t)<=parseFloat(e)},"s>":function(e,t){return t>e},"s>=":function(e,t){return t>=e},"s<":function(e,t){return e>t},"s<=":function(e,t){return e>=t},"=":function(e,t){return t==e},"==":function(e,t){return t===e},"!":function(e,t){return t!=e},"!=":function(e,t){return t!==e},"#":function(e,t){return!_.isUndefined(t)},"!#":function(e,t){return _.isUndefined(t)}},r=/^(>=|>|<=|<|s>=|s>|s<=|s<|==|=|#|!#|!=|!)?\s*(.*)\s*/,s=/\s*=>\s*/,a=/\s*\/\s*/;t["if"]=function(e,t,n){var r=t.split(a);return _.find(r,function(t){var r=t.split(s);return 1===r.length?(this[r[0]].call(this,e,n),!0):i(r[0],n)?(this[r[1]].call(this,e,n),!0):!1},this)}}),define("bbmv",["require","exports","module","lodash","jquery","bbdv","lowercase-backbone","bbmv/pipe/index","bbmv/aux","bbmv/directives","bbmv/pipe-methods/if"],function(e,t,i){function n(){return["bbdv",this.namespace,this.cid,"id"].join("_")}var r=e("lodash"),s=(e("jquery"),e("bbdv")),a=(e("lowercase-backbone"),e("bbmv/pipe/index")),o=(e("bbmv/aux"),i.exports=s.extend({initialize:function(e){if(this.namespace=e.namespace||this.namespace,this.pipeIdAttr=n.call(this),this.pipes={},s.prototype.initialize.call(this,e),!this.model)throw new Error("No model set for model view.");if(!this.$el)throw new Error("No el set on model view.");this.model.on(this.event,function(){this.pump()},this),this.pump()},event:"change",namespace:"bind",pump:function(){return r.each(this.pipes,function(e){e.pump()}),this},drain:function(e,t,i){return this.pipe(e).drain(t,i),this},pipe:function(e,t,i){var n,s=e.data(this.pipeIdAttr);return s&&this.pipes[s]?n=this.pipes[s]:(s=r.uniqueId(this.pipeIdAttr),i=i||{},i.context=this,n=this.pipes[s]=a(this.model,e,t,i),e.data(this.pipeIdAttr,s)),n}}));o.assignProto(e("bbmv/directives")).assignProto(e("bbmv/pipe-methods/if"))});